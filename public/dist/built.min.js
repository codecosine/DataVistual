!function(){"use strict";angular.module("app",["app.routes","app.auth","app.dataOrigin","app.dashboard"])}(),function(){"use strict";angular.module("app.auth",[])}(),function(){"use strict";angular.module("app.dashboard",["angular-echarts","ui.bootstrap","rzModule","ui.select","ngHandsontable"])}(),function(){"use strict";angular.module("app.dataOrigin",["angularFileUpload"])}(),function(){"use strict";function a(a,b,c,d,e,f,g){c.$on("$stateChangeStart",function(a,b){var g={requiredLogin:b.access.requiredLogin,loged:c.isLogged(),localtoken:d.sessionStorage.token,servicetoken:f.token(),userinfo:f.userinfo};console.log(g),null!=b&&null!=b.access&&b.access.requiredLogin&&!c.isLogged()&&(console.log("你没有权限访问这个页面，请登录后重试"),e.path("/welcome"))}),c.$state=a,c.$stateParams=b,c.isLogged=f.isLogged,c.userinfo=f.userinfo,c.signin=function(){g.open({animation:!0,templateUrl:"views/includes/signIn.html",controller:"SignController",controllerAs:"auth"})},c.signup=function(){g.open({animation:!0,templateUrl:"views/includes/signUp.html",controller:"SignController",controllerAs:"auth"})},c.shortcut=function(){c.isLogged()?e.path("/app/dashboard"):c.signin()},c.logout=function(){f.logout()}}function b(a,b,c){a.interceptors.push("tokenInterceptor"),c.otherwise("/welcome"),b.state("welcome",{url:"/welcome",views:{"":{templateUrl:"views/includes/base.html"},"main@welcome":{templateUrl:"views/pages/welcome.html"}},access:{requiredLogin:!1}}).state("app",{url:"/app",views:{"":{templateUrl:"views/includes/base.html"}},access:{requiredLogin:!0}}).state("app.dashboard",{url:"/dashboard",views:{"main@app":{templateUrl:"views/pages/dashBoard.html"}},access:{requiredLogin:!0}})}angular.module("app.routes",["ui.router"]),angular.module("app.routes").controller("localController",a),a.$inject=["$state","$stateParams","$scope","$window","$location","authenticationService","$uibModal"],angular.module("app.routes").config(b),b.$inject=["$httpProvider","$stateProvider","$urlRouterProvider"]}(),function(){"use strict";function a(a){function b(b,c,d){function e(){var a,b,e=c.parent()[0],f=e.clientWidth,g=e.clientHeight;return a=parseInt(d.width)||f||700,b=parseInt(d.height)||g||400,e.style.width=a+"px",e.style.height=b+"px",e}var f,g=e();f=echarts.init(g),b.option&&f.setOption(b.option),a.push(f,d.chartid)}var c={link:b,restrict:"EA",template:"<div></div>",scope:{option:"="}};return c}angular.module("angular-echarts",[]),angular.module("angular-echarts").directive("echarts",a),a.$inject=["echartService"]}(),function(){"use strict";function a(a){function b(a){return k[a]?k[a]:{}}function c(){return Object.keys(k)}function d(a,b){a&&(b?k[b]=a:k[a.id]=a)}function e(a,c,d){if(!a||!c)throw new error;b(a).setOption(c,d)}function f(a){b(a).dispose()}function g(a){b(a).clear()}function h(a){b(a).resize()}function i(a){return b(a).getOption()}function j(b){return a.getOption(b)}var k={};return{get:b,push:d,getInstanceId:c,getInstanceOption:i,generateOption:j,render:e,resize:h,dispose:f,clear:g}}angular.module("angular-echarts").factory("echartService",a),a.$inject=["echartsOptionsService"]}(),function(){"use strict";function a(){function a(a){var d=a[0].type,e=angular.extend({},b[d]),f=a.map(function(a){return a.name}),g=[];return a.forEach(function(a){if(a.axis){if(console.log("坐标轴设置"),console.log(a),console.log(e),console.log(e),!e[a.axis])throw new Error("当前图表类型不支持这种坐标轴");e[a.axis].data=a.data,e[a.axis].name=a.name,e[a.axis].type=a.type}else{var b=angular.extend({},e.series[0]);b.name=a.name,b.data=a.data,b.type=a.type,g.push(b)}}),e.legend.data=f,e.series=g,c[d].call(e,a),e}var b={parallel:{backgroundColor:"#333",legend:{bottom:30,data:[],itemGap:20,textStyle:{color:"#fff",fontSize:14}},parallelAxis:[],parallel:{left:"5%",right:"18%",bottom:100,parallelAxisDefault:{type:"value",name:"平行轴",nameLocation:"end",nameGap:20,nameTextStyle:{color:"#fff",fontSize:12},axisLine:{lineStyle:{color:"#aaa"}},axisTick:{lineStyle:{color:"#777"}},splitLine:{show:!1},axisLabel:{textStyle:{color:"#fff"}}}},series:[{type:"parallel",lineStyle:{normal:{width:1,opacity:.5}}}]},scatter:{legend:{data:[],left:"right"},xAxis:[{type:"value",scale:!0}],yAxis:[{type:"value",scale:!0}],series:[{type:"scatter",markPoint:{data:[{type:"max",name:"最大值"},{type:"min",name:"最小值"}]},markLine:{data:[{type:"average",name:"平均值"}]}}]},bar:{tooltip:{trigger:"axis"},legend:{data:[]},xAxis:[{type:"category",data:[]}],yAxis:[{type:"value"}],series:[{type:"bar"}]}},c={bar:function(){},line:function(){},scatter:function(){},parallel:function(a){var b=a[0].dismension;b=b.map(function(a,b){var c={};return c.dim=b,c.name=a,c}),console.log(b),this.parallelAxis=b}};return{getOption:a}}angular.module("angular-echarts").factory("echartsOptionsService",a)}(),function(){"use strict";function a(a,b,c){a.sessionStorage.token&&(console.log("存在客户端令牌jwt"),c.updatetoken(a.sessionStorage.token),b.first().then(function(a){c.login(),c.userinfo.username=a.data.username},function(){console.log("客户端储存的令牌已经过期")}))}angular.module("app.auth").run(a),a.$inject=["$window","userService","authenticationService"],angular.module("app.auth").constant("AUTH_EVENTS",{loginSuccess:"auth-login-success",loginFailed:"auth-login-failed",logoutSuccess:"auth-logout-success",sessionTimeout:"auth-session-timeout",notAuthenticated:"auth-not-authenticated",notAuthorized:"auth-not-authorized"})}(),function(){"use strict";function a(){var a=!1,b="";return{isLogged:function(){return a},login:function(){a=!0},logout:function(){a=!1,b=""},token:function(){return b},updatetoken:function(a){b=a},userinfo:{username:"尚未登录",database:[]}}}angular.module("app.auth").factory("authenticationService",a)}(),function(){"use strict";function a(a,b,c,d,e,f){var g=this;g.credentials={username:"",password:""},g.register={username:"",password:"",passwordConfirm:""},g.changeToSignIn=function(){c.close(),d.open({animation:!0,templateUrl:"views/includes/signIn.html",controller:"SignController",controllerAs:"auth"})},g.changeToSignUp=function(){c.close(),d.open({animation:!0,templateUrl:"views/includes/signUp.html",controller:"SignController",controllerAs:"auth"})},g.signUp=function(b){e.signUp(b).success(function(b){alert("注册成功，确定跳转到使用页"),a.path("/app/dashboard"),console.log("success"),console.log(b)}).error(function(a,b){alert("由于故障，注册失败，请重试"),console.log("failed"),console.log(a),console.log(b)})},g.signIn=function(d){e.signIn(d).success(function(d){c.close(),f.updatetoken(d.token),f.login(),f.userinfo.username=d.username,b.sessionStorage.token=d.token,a.path("/app/dashboard")}).error(function(a,b){console.log(a),console.log(b)})}}angular.module("app.auth").controller("SignController",a),a.$inject=["$location","$window","$uibModalInstance","$uibModal","userService","authenticationService"]}(),function(){"use strict";function a(a,b){return{request:function(a){a.headers=a.headers||{};var c=b.token();return c&&(a.headers.Authorization=c),a},response:function(b){return b||a.when(b)}}}angular.module("app.auth").factory("tokenInterceptor",a),a.$inject=["$q","authenticationService"]}(),function(){"use strict";function a(a){return{signIn:function(b){return a.post("/signin",b)},signUp:function(b){return a.post("/signup",b)},first:function(){return a.post("/isLoged")}}}angular.module("app.auth").factory("userService",a),a.$inject=["$http"]}(),function(){"use strict";function a(a,b,c){var d=this;d.active=1,d.step=1,d.step_2=function(a){d.chartType=d.chartTypeArray[a],d.step=2},d.typeBar=[{index:1,name:"散点图"},{index:2,name:"折线图"},{index:3,name:"柱状图"},{index:4,name:"饼图"},{index:5,name:"平行坐标"},{index:6,name:"热力图"},{index:7,name:"矩形图"},{index:8,name:"雷达图"},{index:9,name:"地图"}],d.chartTypeArray=[{id:0,index:1,name:"标准散点图",value:"scatter",imageUrl:"img/gallery/scatter-weight.png",src:"views/includes/scatter.html"},{id:1,index:2,name:"标准折线图",value:"line",imageUrl:"img/gallery/dynamic-data2.png",src:"views/includes/line.html"},{id:2,index:3,name:"标准柱状图",value:"bar",imageUrl:"img/gallery/bar1.png",src:"views/includes/bar.html"},{id:3,index:4,name:"标准饼图",value:"pie",imageUrl:"img/gallery/pie-nest.png",src:"views/includes/pie.html"},{id:4,index:5,name:"平行坐标系",value:"parallel",imageUrl:"img/gallery/parallel-aqi.png",src:"views/includes/parallel-aqi.html"},{id:5,index:6,name:"热力图",value:"heatmap",imageUrl:"img/gallery/bar1.png",src:"views/includes/heatmap.html"},{id:6,index:7,name:"矩形图",value:"treemap",imageUrl:"img/gallery/treemap-disk.png",src:"views/includes/treemap.html"},{id:7,index:8,name:"雷达图",value:"radar",imageUrl:"img/gallery/radar-aqi.png",src:"views/includes/radar.html"},{id:8,index:9,name:"地图",value:"map",imageUrl:"img/gallery/map-china-dataRange.png",src:"views/includes/map.html"}],d.dataTypeList=[{data:"数据属性名1",title:"数据属性名1",readOnly:"false"},{data:"数据属性名2",title:"数据属性名1",readOnly:"false"},{data:"数据属性名3",title:"数据属性名1",readOnly:"false"},{data:"数据属性名4",title:"数据属性名1",readOnly:"false"}],d.typeForm={typeName:"",selectTypes:[]},d.chartType=d.chartTypeArray[0],d.serise=[],d.createType=function(a){var c=b.getData(a.selectTypes),e={};e.name=a.typeName,e.type=d.chartType.value,e.data=c,d.serise.push(e)},d.importOrigin=function(){var a=b.importData(c.getSettings());a.then(function(){console.log("promise"),d.dataTypeList=b.getTypeName()},function(a){alert("导入数据失败：未配置数据源或其他原因："+a)})},d.createChart=function(){a.$emit("createChart",d.serise)}}angular.module("app.dashboard").controller("ChartsCreate",a),a.$inject=["$scope","dataDealService","originSetting"]}(),function(){"use strict";function a(){var a=!1;return{isLogged:function(){return a}}}angular.module("app.dashboard").factory("currentSeries",a)}(),function(){"use strict";function a(a,b,c){var d="",e=this;e.active=1,e.start=function(){e.pageElement.menuShow=!0,e.active=4},e.showpanel=function(a){return a==e.active},e.pageElement={menuShow:!1,excelShow:!1,toolbarShow:!1,editShow:!1,enewShow:!1,projectShow:!0},e.themeArray=[{name:"shine",value:"shine",imageUrl:"img/theme/shine.png"},{name:"infographic",value:"infographic",imageUrl:"img/theme/infographic.png"},{name:"dark",value:"dark",imageUrl:"img/theme/dark.png"},{name:"roma",value:"roma",imageUrl:"img/theme/roma.png"},{name:"vintage",value:"vintage",imageUrl:"img/theme/vintage.png"},{name:"macarons",value:"macarons",imageUrl:"img/theme/macarons.png"}],e.AxisArray=[{name:"数值轴",value:"value"},{name:"类目轴",value:"category"},{name:"时间轴",value:"time"},{name:"对数轴",value:"log"}],e.chartWidthOption={floor:600,ceil:2e3,showTicks:200},e.chartWidth=1e3,e.render=function(){c.render("cosine",e.config)},e.dispose=function(){c.dispose("cosine")},a.$watch("dash.chartWidth",function(a,e){a!==e&&(d&&b.cancel(d),d=b(function(){c.resize("cosine")},500))},!0),a.$watch("dash.baseStyle",function(a,e){a!==e&&(d&&b.cancel(d),d=b(function(){c.render("cosine",a)},700))},!0),a.$on("createChart",function(a,b){e.pageElement.projectShow=!1;var d=c.generateOption(b);console.log(d),c.render("cosine",d)})}angular.module("app.dashboard").controller("DashBoardCtrl",a),a.$inject=["$scope","$timeout","echartService"]}(),function(){"use strict";function a(a,b){var c=[];return{mysql:function(b){return a.post("/mysql",b)},mysqlTest:function(b){return a.post("/mysqlTest",b)},xlsx:function(b){return a.post("/xlsx",b)},getTypeName:function(){if(!c[0])throw new Error;var a=Object.keys(c[0]);return a=a.map(function(a){var b={};return b.data=a,b.title=a,b.readOnly=!1,b})},importData:function(d){return b(function(b,e){"json"==d.type&&(c=d.json,b("Hello, "+name+"!")),(d.type="excel")&&a.post("/xlsx",d.excel).then(function(a){c=a.data,b("xlsx deal success")},function(a){e("Greeting "+a+" is not allowed.")})})},getData:function(a){var b=c.map(function(b){var c=[];return a.forEach(function(a){c.push(b[a.data])}),c});return b}}}angular.module("app.dataOrigin").factory("dataDealService",a),a.$inject=["$http","$q"]}(),function(){"use strict";function a(a,b,c,d){var e=this;e.databaseSetting={type:"",mysql:{},excel:{paths:[]},json:{}},e.mysqlSetting={host:"",port:"",database:"",user:"",password:""},e.jsonArea="请在此处粘贴导入的JSON文本",e.jsonSure=function(){var a=JSON.parse(e.jsonArea);e.databaseSetting.json=a},e.mysqlTest=function(a){e.pageElement.mysqlTestSuccess=!1,e.pageElement.mysqlTestFail=!1,c.mysqlTest(a).then(function(a){a.data.success&&(e.databaseSetting.mysql=e.mysqlSetting,e.pageElement.mysqlTestSuccess=!0)},function(a){if(e.pageElement.mysqlTestFail=!0,a)throw a})},e.saveSetting=function(a){e.databaseSetting.type=a,d.setSettings(e.databaseSetting)},e.pageElement={mysqlTestSuccess:!1,mysqlTestFail:!1,jsonTestFail:!1,jsonTestSuccess:!1};var f=["mysql","excel","json"];e.show=function(a){return f[a]===e.origin},e.origin=f[0],e.select=function(a){e.origin=f[a]},e.xlsxUploader=new a({url:"/uploadXlsx",headers:{Authorization:b.token()}}),e.UploadItem={onSuccess:function(a){if(a.success){var b={};b.name=a.name,b.path=a.path,e.databaseSetting.excel.paths.push(b)}}}}angular.module("app.dataOrigin").controller("DataBaseSet",a),a.$inject=["FileUploader","authenticationService","dataDealService","originSetting"]}(),function(){"use strict";function a(){var a={};return{setSettings:function(b){a=b},getSettings:function(){return a}}}angular.module("app.dataOrigin").factory("originSetting",a)}();